# "Knowledge Plus: Система управления знаниями"

## Описание:      
    Данное веб-приложение является шаблоном платформы для онлайн-обучения.
    Содержит два отдельных приложения приложения: 
    "materials" - приложение, в котором прописана основная логика платформы для онлайн-обучения;    
    "users" - приложение для регистрации и авторизации пользователей, а также для настройки доступа для 
    авторизированных пользователей. Также в данном приложении содержится информация о платежах пользователей.    

---

## Содержание:
* ## <a id="title1">Описание</a>
* ## <a id="title1">Технологический стек</a>
* ## <a id="title1">Установка и настройка</a>
* ## <a id="title1">Описание приложений</a>
* ## <a id="title1">Команда проекта</a>
* ## <a id="title1">Источники</a>

---

## Технологический стек

*   Backend:
    *   Язык: Python 3.12
    *   Веб-фреймворк: Django 5.2.3
    *   API: Django REST framework (DRF) 3.16.0
    *   Аутентификация API: Django REST framework Simple JWT 5.5.0
    *   База данных: PostgreSQL (с использованием `psycopg2-binary` 2.9.10)
    *   Обработка изображений: Pillow 11.2.1
    *   Фильтрация данных: Django Filter 25.1
    *   Платежи: Stripe 12.3.0
    *   Управление переменными окружения: python-dotenv 1.1.1
    *   Документация API: drf-yasg 2.1.10 (для генерации Swagger/OpenAPI)

*   Асинхронные задачи (Task Queue):
    *   Движок: Celery 5.5.3
    *   Планировщик (Scheduler): django-celery-beat 2.8.1
    *   Брокер сообщений: Redis 6.2.0
    *   Среда выполнения: eventlet (для асинхронной работы Celery)

*   Инструменты разработки и линтинга:
    *   Управление зависимостями: Poetry
    *   Интерактивная оболочка: IPython 9.4.0
    *   Тестирование покрытия: Coverage 7.9.2
    *   Форматирование кода: Black 25.1.0
    *   Сортировка импортов: isort 6.0.1
    *   Линтер: Flake8 7.3.0      

## Установка и настройка

### Предварительные требования

*   [Git](https://git-scm.com/downloads)
*   [Docker](https://docs.docker.com/get-docker/)
*   [Docker Compose](https://docs.docker.com/compose/install/)

### Клонирование репозитория

```bash
git clone git@github.com:MikhailGubin/knowledge_plus.git
cd <название_папки_проекта>
```
### Настройка переменных окружения

Скопируйте файл .env.example и заполните его:

```
cp .env.example
```

Откройте .env в текстовом редакторе и настройте переменные.


Совет: Для генерации SECRET_KEY вы можете использовать команду Python:

```
python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
```

### Запуск проекта
С помощью Docker Compose
Для запуска всех сервисов (PostgreSQL, Redis, Celery, Beat, Django Web):

```
docker-compose up -d --build
```

### Проверка работоспособности

#### Веб-приложение
Откройте браузер и перейдите по адресу: http://localhost:8000

#### Сервисы
    PostgreSQL:
    к базе данных, используя переменные из вашего `.env` файла:
    postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@localhost:5432/${POSTGRES_DB}
    Проверьте логи контейнера: 
```
docker-compose logs db
```

    Redis:
    Проверьте логи контейнера: 
```
docker-compose logs redis
```
    Celery & Beat:
    Проверьте логи контейнеров: 
```
bash docker-compose logs celery docker-compose logs beat
```

### Остановка проекта

    Остановка контейнеров
```
    docker-compose down
```

    Остановка и удаление данных (Полный сброс)
    ВНИМАНИЕ: Эта команда удалит все данные PostgreSQL и Redis!
```
docker-compose down -v
```

---

## Описание приложений:

1. #### Приложение mailing_service 
##### Описание:        
    Созданы следующие модели:

    Модель «Курс»:
    * название,
    *превью (картинка),
    *описание,
    *владелец.
    
    Модель «Урок»:
    * название,
    *описание,
    *превью (картинка),
    *ссылка на видео,
    *владелец.

    Созданы CRUD для моделей Курс и Урок. Для реализации CRUD для курса использовано Viewset, 
    а для урока - Generic-классы.
    Для модели "Курс" добавлен сериализатор для вывода поля количества уроков, а также реализовано поле вывода уроков.
    Для моделей "Курс" и "Урок" данные записаны в файл materials_fixture.json с фикстурами.
    Для поля ссылка на видео для модели "Урок" реализована дополнительная проверка на отсутствие в 
    материалах ссылок на сторонние ресурсы, кроме youtube.com.
    Реализована пагинация для вывода всех уроков и курсов.
    Проект содержит тесты, которые проверяют корректность работы CRUD уроков.
    
   
2. #### Приложение users 
##### Описание: 
    Созданы следующие модели:
    Модель «Пользователь»:   
    * все поля от обычного пользователя, но авторизацию заменить на email;
    *пароль,
    * аватар (изображение),
    * телефон,
    * город

    Модель «Платеж»:   
    * пользователь,
    * дата оплаты,
    * оплаченный курс,
    * оплаченный урок,
    * сумма оплаты,
    * способ оплаты: наличные или перевод на счет.

    Модель «Подписка»:
    * пользователь,
    * курс.

    Модель «Оплата курса»:
    * пользователь;
    * оплаченный курс;
    * дата и время платежа;
    * сумма оплаты;
    * id сессии:
    * ссылка на оплату.
    
    Электронная почта используется как поле для авторизации.
    Созданы CRUD для модели Пользователь. Для реализации CRUD использовано APIView.
    Каждый эндпоинт в проекте закрыт авторизацией, кроме регистрации и авторизации пользователей.
    В данном проекте использована JWT-авторизация.
    Для моделей "Платежи" и "Пользователь" данные записаны в соответствущие файлы с фикстурами 
    (payments_fixture.json, users_fixture.json). 
    Настроена фильтрация для эндпоинта вывода списка платежей с возможностью:
    * менять порядок сортировки по дате оплаты;
    * фильтровать по курсу или уроку;
    * фильтровать по способу оплаты.  
    Создана группа модераторов. Модераторы могут работать с любыми уроками и курсами, но не могут их удалять
    и создавать новые.
    Авторизованные пользователи, которые не входят в группу модераторов, могут видеть, редактировать и удалять
    только свои курсы и уроки.
    Создана команда для создания суперпользователя - csu.
    Для заполнения группы модераторы в базе данных создана фикстура users/fixtures/groups.json
    Добавлена модель подписки на обновления курса для пользователя.
    При выборке данных по курсу пользователю присылается информация, подписан данный пользователь 
    на обновления курса или нет. Данную подписку можно добавлять и удалять.
    После обновления материалов курса подписанным пользователям приходят письма на почту с информацией.
    Проект содержит тесты, которые проверяют функционал работы подписки на обновления курса.
    Подключена возможность оплаты курсов через https://stripe.com/docs/api.
    Для работы с запросами реализовано обращение к эндпоинтам:
    — создание продукта;
    — создание цены;
    — создание сессии для получения ссылки на оплату.
    Если пользователь не заходил на сайт более 1 месяца, то он блокируется с помощью флага is_active.    
---

## Команда проекта:
* Губин Михаил — Back-End Engineer

---

## Источники:
* курс лекций и учебных материалов учебного центра "SkyPro"
